============================================================
Oracle iAS Autostart                  (C) 2006-2010 Y.Voinov
============================================================

                      ***************
                      * Version 2.5 *
                      ***************

Данный     набор     скриптов    позволяет    активизировать
и  деактивировать  автоматический  запуск и останов сервисов
Oracle  iAS  (Infrastructure,    Middle    Tier,  Standalone
WebCache)   и   всех   его   производных   в  одно  действие
на следующих системах:

- Solaris 8,9
- Solaris 10 и выше
- Linux (RHEL3/4/5, SuSE, Fedora, Oracle Enterprise Linux)

Для выполнения автостарта сервисов Oracle используется набор
скриптов  init.ias_infra, init.ias_midtier, init.ias_wcache.
В  зависимости  от   платформы  (Solaris  8-10  и  выше либо
Linux),  создаются  либо  ссылки  в  директории  /etc/rc3.d,
либо    производится   регистрация  сервиса    и    создание
ссылок    командой   chkconfig  (Linux),  либо  производится
регистрация сервиса(-ов) в службе SMF.

Распознавание    платформы    производится    автоматически.
Автозапуск может выполняться для инфраструктуры iAS и middle
tier iAS,  установленных  либо  на  одной  машине,  либо  на
двух  (enterprise     installation)    (в     том      числе
с   конфигурированием     OHS/WebCache     на  использование
80   порта   или  SSL).  Также поддерживается автозапуск для
установки iAS Standalone WebCache.

Для   установки  скриптов   (-ов)   и/или   создания  ссылок
и     регистрации    дескрипторов    сервисов   автозапуска,
используется  скрипт  install.ksh  либо  (при необходимости)
возможна   пошаговая  (поэтапная  или  помашинная) активация
автозапуска  с  использованием скриптов   inst_*.sh  .

Перед     запуском     установки     необходимо    проверить
и отредактировать переменные конфигурационных файлов *.conf
в  зависимости от конфигурации сервисов целевого хоста(-ов).
Разумеется,скрипты    установки   и   удаления   автозапуска
install.ksh/remove.ksh/inst_*.sh/rm_*.sh  должны запускаться
от аккаунта root.

ASM
===

Начиная   с  данной  версии,  поддерживается  автоматический
запуск  БД  инфраструктуры на ASM. При этом запуск и останов
экземпляров    ASM   и   СУБД   выполняется   в   правильной
последовательности.

Принцип работы
==============

Запуск  компонентов iAS должен осуществляться в определенной
последовательности.
При  старте  iAS  первой  должна  стартовать  инфраструктура
-    RDBMS,    listener,    OIS,    SSO,   OHS,   iasconsole
в последовательности:

1. Listener
2. ASM
3. RDBMS
4. OPMN
5. OID
6. SSO
7. OHS
8. iasconsole
9. (при использовании iAS 10R2 и выше) dbconsole

Только после запуска инфраструктуры должны стартовать middle
tier и (если существуют) отдельно стоящие WebCache.*

Middle tier также стартует в определенной последовательности:

1. OPMN (включая компоненты middle tier)
2. iasconsole

---------------------------
* Standalone  WebCache  не нуждается для своего  корректного
  запуска в необходимости запуска инфраструктуры, хотя может
  быть зарегистрирован в ней.

При   использовании   OCS   также  дополнительно  необходимо
стартовать на middle tier TNS listener (для работы IMAP).

При  этом  middle tier не должен стартовать до тех пор, пока
не   будет   запущена  инфраструктура  (поскольку  требуется
регистрация  сервисов middle tier в OID), вне зависимости от
того,   происходит   запуск  локальной  инфраструктуры,  или
удаленной.

При  запуске  Standalone  WebCache  иногда  необходимо также
стартовать iasconsole, которая устанавливается вместе с ним.

Для обеспечения необходимой логики запуска стартовые скрипты
написаны соответствующим образом. Инфраструктура запускается
без    дополнительных   проверок,   процесс  автоматического
запуска   middle   tier   после  старта  хоста  периодически
проверяет,     стартовала     ли   инфраструктура.  Проверки
выполняются    как    при    одномашинной   установке   (все
компоненты iAS установлены на единственном хосте), так и при
enterprise установке (компоненты установлены минимум на двух
машинах - инфраструктура и middle tier). 

При  этом  данные  проверки не выполняются до бесконечности.
Если в течение определенного таймаута стартующая middle tier
не  смогла  увидеть  работающую  инфраструктуру, последующий
старт  процессов  middle  tier не выполняется и в журнальном
файле делается соответствующая запись.

В  соответствие  с  рекомендациями enterprise-установки, iAS
может  быть  сконфигурирован  с несколькими middle tier, все
они   будут  стартовать  только  после  запуска  центральной
инфраструктуры.

Автошатдаун сервисов iAS при шатдауне хостов выполняется без
дополнительных  проверок,  но также с соблюдением правильной
последовательности   остановки  процессов  iAS  (в  порядке,
обратном порядку запуска).

Конфигурирование инфраструктуры для автоматического запуска
===========================================================

Для   инфраструктуры,   отредактируйте   при   необходимости
переменные файла ias_infra.conf:

#
# oratab location. 
# Leave variable blank to use /var/opt/oracle/oratab
#
ORATAB=""
^^^^^^^^^  На некоторых платформах необходимо задавать явно,
если  oratab  отсутствует  в  стандартных месторасположениях
(/var/opt/oracle/oratab  либо  /etc/oratab). Задается полный
абсолютный  путь  и имя файла oratab (не обязательно oratab,
но  стандартной  структуры).  

ВАЖНО    -  Флаг  автоматического  запуска  в  файле  oratab
меняется  явно при установке и удаления сервиса - ставится Y
если    сервис    автоматического   запуска   инфраструктуры
активизируется     и    ставится    N    при   деинсталляции
автоматического запуска инфраструктуры.

#
# ORACLE_SID and ORACLE_HOME variables.
# Leave variables blank to use oratab
#
ORACLE_SID=""
ORACLE_HOME=""
^^^^^^^^^^^^^   Если  параметры  заданы  явно,  для  запуска
RDBMS/Listener  будут  использованы  они,  а  не  содержимое
oratab  (взятое  в  стандартных  местах  или  явно  заданное
в предыдущем параметре).

#
#  Startup/shutdown  privilege  for  "connect  as"  to RDBMS
#  instance(s).
# By default is "sysdba".
#
#ORACLE_DB_PRIV="sysoper"
ORACLE_DB_PRIV="sysdba"
^^^^^^^^^^^^^^^^^^^^^^   Системная  привилегия,  позволяющая
выполнять   запуск/останов   Oracle.  По  умолчанию  sysdba.
В  вашей  системе может отличаться (задается при инсталляции
Oracle).
#
#   Startup/shutdown  privilege  for  "connect  as"  to  ASM
#   instance(s).
# By default is "sysdba" (Oracle 10),
# set to "sysasm" for Oracle 11 and above.
#
#ORACLE_ASM_PRIV="sysasm"
ORACLE_ASM_PRIV="sysdba"
^^^^^^^^^^^^^^^^^^^^^^^^     Привилегия     запуска/останова
инстансов  ASM.  В  Oracle  10 - sysdba, начиная с Oracle 11
- sysasm. По умолчанию sysdba.

#
# ASM shutdown mode. In some cases (not patched DB etc.) ASM
# instance cannot shutdown in immediate mode after correctly
# shutdown main DB  and  must be stopped # in shutdown abort
# mode.
#
# Beware, that this stop mode can damage your ASM diskgroups!
#
#ASM_SHUTDOWN_MODE="abort"
ASM_SHUTDOWN_MODE="immediate"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  Режим  останова сервисов ASM.
В  некоторых  случаях  после  корректного  останова основных
сервисов  баз  данных  сервисы ASM не могут быть остановлены
в  режиме  immediate  (не  установленные  патчи  итп.).  Для
подобных   ситуаций   предусмотрен   останов  инстансов  ASM
в  режиме  abort.  Учтите, что подобное завершение ASM может
привести к повреждению дисковых групп и не рекомендуется без
крайней необходимости.

#
# If configured OEM iasconsole, set USEIASCTL to 1. 
# Leave blank if not.
# Default value: 1
USEIASCTL="1"
^^^^^^^^^^   Для iAS консоль всегда конфигурируется в рамках
процедуры  установки.  Если   необходимо   запускать   ее  в
рамках   процедуры  автозапуска, параметр необходимо задать.
При   доступе к  системе из Интернет, iasconsole должна быть
предварительно   сконфигурирована   для   работы   под   SSL
(например, командой emctl  secure  iasconsole).  В некоторых
очень   редких   случаях   автоматический   запуск   консоль
управления   не  может  быть выполнен и запускать ее следует
вручную.

#
# If configured OEM dbconsole, set USEDBCTL to 1. 
# Leave blank if not.
# Default value: none
# Note: dbconsole supported only from Oracle10g(>iAS 10g R2)
USEDBCTL=""
^^^^^^^^^^^ OEM dbconsole используется в случае использвания
iAS  >  10g R2 (в его состав входит RDBMS 10g). По умолчанию
предполагается,  что  используется iAS R1 и, соответственно,
данный  параметр  не  задан.  Если  требуется  автоматически
запускать  dbconsole  (при  использовании  iAS  R2  и  выше,
в  состав  которых  входит  СУБД  Oracle10g), следует задать
данный параметр равным 1.

#
# If configured OCA (Certified Authority), set USEOCA to 1. 
# Leave blank if not.
# Default value: none
# Note: OCA required additional ocactl start/stop command 
# on some iAS'es
USEOCA=""
^^^^^^^^^  Параметр  задается,  если  необходимо  выполнение
запуска   OCA   (ocactl  start).  Следует  учесть,  что  при
конфигурировании  OCA задается корневой пароль и его следует
вводить  при  запуске. По этой причине значение параметра по
умочанию равно "пусто" (запуск OCA не производится. При этом
OC4J сервис OCA стартует все равно в рамках процессов старта
инфраструктуры).

#
# Log file. Default /var/adm/oracle.log
#
LOG="/var/log/oracle.log"
^^^^^^^^^^^^^^^^^  Путь  и  имя лог-файла по умолчанию. Если
файл   не   существует   (скажем,   регулярно  обслуживается
процессом   cron)   то   он   будет  создан  при  выполнении
init.ias_infra .

Конфигурирование middle tier для автоматического запуска
========================================================

Для   middle  tier  редактируются следующие переменные файла
ias_midtier.conf:

#
# ORA_HOME variable for middle tier.
# This is substitution variable for legal
# ORACLE_HOME variable below. 
# DO NOT RENAME THIS VARIABLE!!
ORA_HOME="/export/home/OraHome2"
^^^^^^^^  Домашний  каталог  ORACLE_HOME  для  middle  tier.
Должен  быть  задан в обязательном порядке, поскольку запись
oratab  для  middle  tier  может  отсутствовать, так же, как
и oratab. НЕ ПЕРЕИМЕНОВЫВАЙТЕ ДАННУЮ ПЕРЕМЕННУЮ!

#
# If configured OEM iasconsole, set USEIASCTL to 1. 
# Leave blank if not.
# Default value: 1
USEIASCTL="1"
^^^^^^^^^^  Для  iAS консоль всегда конфигурируется в рамках
процедуры  установки.  Если   необходимо   запускать   ее  в
рамках   процедуры  автозапуска, параметр необходимо задать.
При   доступе к  системе из Интернет, iasconsole должна быть
предварительно   сконфигурирована   для   работы   под   SSL
(например, командой emctl  secure  iasconsole).  В некоторых
очень   редких   случаях   автоматический   запуск   консоль
управления   не  может  быть выполнен и запускать ее следует
вручную.

#
# If installation type is OCS with IMAP, set USETNS to 1. 
# Leave blank if not.
# Default value: null (empty string)
USETNS=""
^^^^^^^^^  Если  необходим автоматический запуск middle tier
OCS,  и  выполнено  конфигурирование IMAP, необходимо задать
параметр  равным  1  для  старта  TNS  listener. В остальных
случаях не задается.

#
# Infrastructure hostname or IP address.
# Must contains remote infrastructure hostname 
# (required entry in /etc/hosts) or IP-address. 
# If IP/hostname for infrastructure node changed,
# must be changed too. 
# Default is local hostname ("``hostname").
#
IHOST="`hostname`"
^^^^^^  Имя  или IP-адрес хоста инфраструктуры. (Мы не можем
автоматически   найти,   где  находится  OID).  По умолчанию
задано   "`hostname`"   для   одномашинной  установки,  либо
необходимо    задать   имя  удаленного  хоста инфраструктуры
(в       этом      случае      файл      /etc/hosts   должен
содержать   соответствующую    запись,   в  противном случае
можно задать IP-адрес инфраструктуры).

#
# OID port. Default 3060 (iAS 9.0.4),
# 389 for iAS 10.1.x - Non SSL,
# if SSL - default 3131 for iAS 9.0.4, 636 for iAS 10.1.x.
# 
# Check after installation on insfastructure iasconsole 
# ports tab before edit.
#
OID_PORT=389
^^^^^^^^   Номер  порта OID инфраструктуры. По умолчанию 389
(стандартный   порт  LDAP),  если   OID   сконфигурирова   с
использованием   SSL,   значение по умолчанию равно 636 (для
iAS  >  10g  R1).  Для iAS 9.0.4 значения по умолчанию равны
3060   для   Non   SSL,  и  3131  для  SSL-порта  OID.  Порт
используется  для проверки, запущена ли инфраструктура. Порт
может иметь другое значение. Номера назначенных портов можно
посмотреть         либо         в         файле       (UNIX)
ORACLE_HOME/install/portlist.ini,  либо в консоли управления
установленного iAS (закладка Farm-><iAS Instance>->Ports).

#
# ONS (OPMN) Request. Default 6004.
# Check after installation on insfastructure iasconsole
# ports tab before edit.
# Default values: 6004 for single host installation,
#                 6003 for enterprise installation.
ONS_REQ=6004
^^^^^^^ Номер порта ONS (OPMN) Request middle tier. Значение
по  умолчанию  зависит  от  типа  установки.  Для  установки
на  одном  хосте  значение по умолчанию 6004, для enterprise
установки - 6003.
Порт используется для проверки запуска служб middle tier.
Порт  может иметь другое значение. Номера назначенных портов
можно      посмотреть      либо      в      файле     (UNIX)
ORACLE_HOME/install/portlist.ini,  либо в консоли управления
установленного iAS (закладка Farm-><iAS Instance>->Ports).
Замчечание:  В  некоторых  установках  iAS  на  одном  хосте
инфраструктура может запускать сервис ONS_REQ на порту 6003.

#
# ONS (OPMN) Remote. Default 6201.
# Check after installation on insfastructure iasconsole
# ports tab before edit.
# Default values: 6201 for single host installation,
#                 6200 for enterprise installation.
ONS_REM=6201
^^^^^^^ Номер порта ONS (OPMN) Remote middle tier. Значение
по  умолчанию  зависит  от  типа  установки.  Для  установки
на  одном  хосте  значение по умолчанию 6201, для enterprise
установки - 6200.
Порт используется для проверки запуска служб middle tier.
Порт  может иметь другое значение. Номера назначенных портов
можно      посмотреть      либо      в      файле     (UNIX)
ORACLE_HOME/install/portlist.ini,  либо в консоли управления
установленного iAS (закладка Farm-><iAS Instance>->Ports).
Замчечание:  В  некоторых  установках  iAS  на  одном  хосте
инфраструктура может запускать сервис ONS_REM на порту 6200.

#
# Grace time. Uses for check infrastructure
# already started. In seconds.
# Recommended value: 15 for single host installation,
#                    60 for enterprise installation.
GRACETIME=15
^^^^^^^^^  Период  времени между попытками обнаружить запуск
инфраструктуры  в  секундах.  По  умолчанию  задается равным
15  секундам  для  одномашинной установки, и 60 секундам для
enterprise-установки.

#
# Grace time 2. Uses for middle tier
# running check. In seconds.
# Recommended value: 5 for iAS/Portal single host,
#                    60 for iAS/Portal enterprise,
#                    60 for OCS single host installation,
#                    180 for OCS enterprise installation.
GRACETIME2=5
^^^^^^^^^^  Период времени между попытками обнаружить запуск
middle  tier  локально.  Время  по умолчанию зависит от типа
установки и, соответственно, количества запускаемых сервисов
(и косвенно зависит от быстродействия хоста middle tier. Чем
менее  мощная машина используется для установки middle tier,
тем    больший    интервал   времени   необходимо   задать).
По  умолчанию  равно  5  секундам для одномашинной установки
iAS/Portal, 60 секундам для iAS/Portal enterprise-установки,
60  секундам  для одномашинной установки OCS, и 180 секундам
для enterprise-установки OCS.

#
# Attempts to connect to infrastructure.
# Recommended value: 10 (150 sec total timeout)
#                              for single host installation,
#                    100 (25 min total timeout)
#                              for enterprise installation.
CHECK_LIMIT=100
^^^^^^^^^^^     Количество    попыток    обнаружить    старт
инфраструктуры  (с  периодичностью  GRACETIME)  и  локальной
middle   tier   (с  периодичностью  GRACETIME2).  Предельный
интервал  обнаружения  старта инфраструктуры, таким образом,
по   умолчанию   составляет   150  секунд  для  одномашинной
установки,     и     1500     секунд    (25    минут)    для
enterprise-установки, а предельное время  обнаружения старта
middle  tier  составит 50 секунд для одномашинной  установки
iAS,   и   1500  секунд (25 минут) для enterprise-установки.
Если    по    завершении    интервала    обнаружения   старт
инфраструктуры обнаружить не удается, процесс запуска middle
tier  прекращается  и  в журнал $LOG пишется соответствующее
сообщение.
При   выполнении   запуска  локального   middle  tier  такое
же количество раз производится попытка  обнаружения  запуска
процессов   middle   tier.  Если middle  tier  по  истечение
периода   GRACETIME2*CHECK_LIMIT  не   запускается,   запуск
middle   tier   прекращается   с   записью  соответствующего
сообщения   в   журнал   $LOG.   Затем  производится  запуск
iasconsole    (если   установлен   параметр  USEIASCTL),   и
в     дальнейшем     администратор      может     произвести
запуск/перезапуск   процессов   процессов     middle    tier
вручную  через  интерфейс  консоли управления.

#
# Log file. Default /var/adm/oracle.log for Solaris,
# /var/log/oracle.log for Linux
#
LOG="/var/log/oracle.log"
^^^^^^^^^^^^^^^^^  Путь  и  имя лог-файла по умолчанию. Если
файл   не   существует   (скажем,   регулярно  обслуживается
процессом   cron)   то   он   будет  создан  при  выполнении
init.ias_midtier .
Если  имя  лог-файла  совпадает  с именем, указанным в файле
ias_infra.conf,  и  iAS  установлен  на  одном хосте, записи
процессов   старта   инфраструктуры   и  middle  tier  будут
добавляться   в   лог-файл   двумя  последовательными  четко
различимыми группами. Администратор может вести и раздельные
журналы запуска/останова групп сервисов iAS.

Конфигурирование WebCache для автоматического запуска
=====================================================

Собственно   установка   Standalone   WebCache   не   совсем
корректный   термин.   Фактически   Oracle   использует  две
установки WebCache:

- WebCache + OC4J (из дистрибутива iAS)
- Standalone WebCache.

Строго   говоря,   установкой  Standalone  WebCache  следует
считать второй вариант.

Отличия   заключаются  в  различном  наборе  ПО  и  сервисов
и различном характере запуска процессов установок WebCache.

Первый  тип  установки  производит запуск процессов WebCache
посредством OPMN и практически во всех случаях устанавливает
и   конфигурирует   iasconsole   для  управления  установкой
WebCache.

Установка  второго  типа  (собственно  Standalone  WebCache)
производит  запуск  процессов  WebCache  посредством утилиты
webcachectl и не содержит в своем составе iasconsole.

По  указанным  причинам  конфигурирование установок WebCache
производится    несколько   различным   образом  для  разных
вариантов инсталляций.

Для   Standalone WebCache редактируются следующие переменные
файла ias_wcache.conf:

#
# ORA_HOME variable for Standalone WebCache.
# This is substitution variable for legal
# ORACLE_HOME variable below. 
# DO NOT RENAME THIS VARIABLE!!
ORA_HOME="/export/home/OraHome2"
^^^^^^^^   Домашний   каталог   ORACLE_HOME  для  Standalone
WebCache.   Должен   быть   задан  в  обязательном  порядке,
поскольку   запись   oratab    для    middle    tier   может
отсутствовать,  так  же,  как  и oratab. НЕ ПЕРЕИМЕНОВЫВАЙТЕ
ДАННУЮ ПЕРЕМЕННУЮ!

#
# If WebCache installed from iAS distributive,OPMN used by
# default. Standalone WebCache uses webcachectl.
# Leave blank if use Standalone WebCache.
# Default value: 1
#
USEOPMN="1"
^^^^^^^  Параметр  задается  при  установках  WebCache+OC4J,
и   _не   задается_   при  установках  Standalone  WebCache.
Поскольку  обычно  WebCache  устанавливается  с дистрибутива
iAS,  он  содержит  OPMN  и  для  запуска процессов WebCache
используется OPMN.

#
# If configured OEM iasconsole, set USEIASCTL to 1. 
# Leave blank if not. Default value: 1
USEIASCTL="1"
^^^^^^^^^^  Для  iAS консоль всегда конфигурируется в рамках
процедуры  установки WebCache+OC4J.
Если    необходимо    запускать    ее   в рамках   процедуры
автозапуска,   параметр   необходимо  задать.  При   доступе
к    системе    из    Интернет,   iasconsole   должна   быть
предварительно  сконфигурирована      для     работы     под
SSL   (например, командой  emctl   secure   iasconsole).   В
некоторых   очень   редких       случаях      автоматический
запуск      консоль  управления    не   может  быть выполнен
и  запускать  ее следует вручную.  При установках Standalone
WebCache  данный параметр не устанавливается (пустая строка)
поскольку   установка   Standalone   WebCache   как  правило
не содержит консоли.

#
# Log file. Default /var/adm/wcache.log
#
LOG="/var/log/wcache.log"
^^^^Путь   и   имя  лог-файла  по  умолчанию. Если файл   не
существует    (скажем,    регулярно  обслуживается процессом
cron)     то     он     будет    создан    при    выполнении
init.ias_wcache . Поскольку запуск процессов WebCache обычно
не  привязывается  к определенной последовательности запуска
других  сервисов  Oracle,  при  установке на хосте не только
сервисов    WebCache    рекомендуется    оставить   значение
по  умолчанию  (отдельный  от  остальных логов автоматически
запускаемых сервисов лог-файл).

Установка и активация сервисов атоматического запуска
=====================================================

Для  установки  сервисов  автозапуска необходимо распаковать
следующие   файлы   (на   каждый  хост  в  случае enterprise
installation или на один при одномашинной установки):

install.ksh         - главный интерактивный скрипт активации
                      автостарта сервисов iAS
remove.ksh          - главный интерактивный скрипт отключения
                      автостарта сервисов iAS
init.ias_infra      - главный старт-стопный скрипт сервисов
                      инфраструктуры
init.ias_midtier    - главный старт-стопный скрипт сервисов
                      middle tier
init.ias_wcache     - главный старт-стопный скрипт сервисов
                      Standalone WebCache
infra.xml           - дескриптор SMF-сервисов инфраструктуры
midtier.xml         - дескриптор SMF-сервисов middle tier
midtier_local.xml   - дескриптор SMF-сервисов middle tier
                      при одномашинной установке.
wcache.xml          - дескриптор SMF-сервисов WebCache
inst_infra.sh       - скрипт установки автостарта infra
inst_midtier.sh     - скрипт установки автостарта midtier
inst_wcache.sh      - скрипт установки автостарта wcache
rm_infra.sh         - скрипт удаления автостарта infra
rm_midtier.sh       - скрипт удаления автостарта midtier
rm_wcache.sh        - скрипт удаления автостарта wcache
readme_ru.txt       - этот файл
readme_en.txt       - English readme
webcache_port80.txt - дополнительные  шаги  по  запуску
                      OHS/WebCache на 80/443 порту
ias_infra.conf      - конфигурационный файл сервиса
                      автозапуска инфраструктуры
ias_midtier.conf    - конфигурационный файл сервиса
                      автозапуска Middle Tier
ias_wcache.conf     - конфигурационный файл сервиса
                      автозапуска WebCache
inst_infra.conf     - конфигурационный файл инсталляции
                      автозапуска инфраструктуры
inst_midtier.conf   - конфигурационный файл инсталляции
                      автозапуска Middle Tier
inst_wcache.conf    - конфигурационный файл инсталляции
                      автозапуска WebCache
rm_infra.conf       - конфигурационный файл удаления
                      автозапуска инфраструктуры

в   необходимый  каталог  и  выполнить  с  правами  аккаунта
root       скрипт      install.ksh.    Скрипт    выполняется
интерактивно,    для   активации   автоматического   запуска
необходимого   набора   сервисов   iAS   необходимо  выбрать
соответствующий  пункт  меню.  После   его   завершения  все
необходимые   файловые  структуры   будут  созданы  и  можно
выполнить   активацию   сервиса   либо   перезапустив   хост
(Solaris 8,9, Linux) либо выполнив команды (Solaris 10):

# svcadm enable ias_infra
# svcadm enable ias_midtier
# svcadm enable ias_wcache

для каждого из компонентов iAS соответственно.

Запуск сервисов можно контролировать в отдельной сессии:

#  tail  -f /var/log/oracle.log  (путь и имя лога могут быть
другими и настраиваются в конфигурационных файлах параметром
LOG)

Для  остановки  и  удаления  автостарта  необходимо  сделать
следующее:

- Для Solaris 8,9, Linux:
1. Остановить сервисы Oracle вручную
2. Выполнить с правами root скрипт remove.ksh

- Для Solaris 10 и выше:
1. Выполнить команды:

# svcadm disable ias_infra
# svcadm disable ias_midtier
# svcadm disable ias_wcache

2. Выполнить с правами root скрипт remove.ksh

Скрипт  remove.ksh  также является интерактивным, работающим
подобно  скрипту  install.ksh.  При  его  запуске появляется
меню,  в котором и надо выбрать целевую конфигурацию iAS, на
которой  производится  деактивация  автоматического запуска.
Перед    выполнением   деактивации   производится   проверка
активации  автозапуска  на данном хосте, если автоматический
запуск  не  активизировался,  то  удаление,  разумеется,  не
выполняется.   При   одномашинной   установке  (все  сервисы
установлены  на  одном хосте) возможно выполнение выборочной
операции  удаления,  например, удалить только автоматчиеский
запуск  инфраструктуры  или  только  middle  tier итд. Также
возможно   выборочное   выполнение  низкоуровневых  скриптов
удаления rm_*.sh.

Замечание:    Операция   активаци/удаления   автоматического
запуска  является  достаточно  безопасной  и  ни  при  каких
обстоятельствах     не     затрагивает    установленных    и
сконфигурированных служб и сервисов iAS.

Управляющие   скрипты  автостарта  также  могут  выполняться
интерактивно (например, с целью отладки).

Возможные проблемы и их устранение
==================================

Брэндмауэры
-----------

При  установке  всех  хостов  iAS  в DMZ (демилитаризованной
зоне)  проблем    с    обнаружением    middle  tier  запуска
сервисов  не   происходит.    Однако,    если   существующая
топология  сети     сложная,    либо    при    использовании
сервисов  IPSec/IPfilter   на   хостах  или  маршрутизаторах
возможны    неограниченные      таймауты      при    попытке
обнаружения  службой  автозапуска    middle    tier    факта
старта     удаленной   инфраструктуры    (установленной   на
другом   хосте).   В   этом случае  необходимо  проверить  и
при   необходимости   изменить  настройки     IPSec/IPfilter
таким    образом,    чтобы    на  маршруте      infra-middle
tier         были        открыты   соответствующие     порты
(приведены        имена      конфигурационных     параметров
ias_midtier.conf         для        стартового       скрипта
init.ias_midtier):

OID_PORT (Default 3060 (iAS 9.0.4), 389 for iAS 10.1.x - Non
SSL,  if  SSL  -  default  3131  for  iAS 9.0.4, 636 for iAS
10.1.x.)
ONS_REQ (Default 6004 for single host installation, 6003 for
enterprise installation.)
ONS_REM (Default 6201 for single host installation, 6200 for
enterprise installation.)

Техническое замечание
---------------------

Брэндмауэры  обычно конфигурируются для отбрасывания пакетов
вне разрешенных диапазонов/портов, вследствие чего процедура
обнаружения  ждет  отклика  неограниченно  долгое время, что
и  приводит  к  "застреванию" процедуры запуска middle tier.
Существующая реализация процедуры обнаружения не отслеживает
фиксированных  таймаутов,  что  и  приводит  к возникновению
данного  эффекта.  Единственным  разумным  решением является
корректное конфигурирование брэндмауэров и портов сервисов.

Замечания
=========

1.Для  запуска  OHS/WebCache от аккаунта root на middle tier
и  Standalone WebCache (при биндинге портов<1024) необходимо
после  конфигурирования  портов  в  webcache.xml (либо через
административную     консоль)     выполнить   дополнительную
операцию     (при   остановленных   сервисах WebCache/middle
tier) от имени аккаунта root:

# cd $ORACLE_HOME/webcache/bin
# ./webcache_setuser.sh setroot <имя владельца oracle>

2. При выполнении автозапуска на Solaris 10 и выше удаленный
middle  tier   проверяет  старт  инфраструктуры по появлению
сервиса   на    порту     OID,  при  одномашинной  установке
локальный     middle    tier       сначала       отслеживает
зависимости     в    рамках XML-дескриптора  сервиса  и   не
начинает   процесс   запуска  middle-tier    до   завершения
процесса   старта  инфраструктуры,  после   чего   проверяет
работоспособность OID обычным образом (сканом порта).

3.  При  установке сервисов автоматического запуска на Linux
в  некоторых  случаях  возможны  аномалии  запуска  консолей
управления  (исключения  Java,  досрочный  частичный  запуск
консолей   итп.).   Данные  проблемы  вызываются  Java-кодом
консолей  управления  в  сочетании  с  символической ссылкой
на native Java операционной системы (/usr/bin/java). С целью
их ликвидации необходимо убедиться, что ссылка /usr/bin/java
смотрит  на  JRE  версии не ниже 1.4.2. В случае, если ОС не
содержит  JRE  данной  версии  или более высокой, необходимо
либо  переопределить  ссылку на JRE 1.4.2, входящий в состав
программного  обеспечения iAS, либо установить последний JRE
с java.com и также изменить ссылку:

# unlink /usr/bin/java
# ln -sf /usr/bin/java <задать $ORACLE_HOME>/jre/1.4.2/bin

либо

# unlink /usr/bin/java
# ln -sf /usr/bin/java /usr/j2se/jre/bin/java

(пути к JRE в вышеприведенных примерах, разумеется, условны)

4.  При  использовании  сервисов  автоматического запуска на
Oracle  Enterprise  Linux в некоторых конфигурациях возможно
возникновение   ситуации,   когда   на   инфраструктуре   не
производится  запуск  OC4J_SECURITY  и,  соответственно,  не
запускается  OSSO.  Однако  консоль управления стартует и, в
этом случае, необходимо вмешательство администратора с целью
ручного  запуска процесса OC4J_SECURITY. После его успешного
старта сервис OSSO стартует автоматически. Аналогично, может
происходить  блокирование  сервиса Discoverer на midle tier,
что  также  может  быть  устранено  ручным запуском процесса
через  iasconsole.
Данная  проблема  также устраняется полным рестартом системы
командой (в частности, командой shutdown -i 6 -y now).
Указанная  особенность  поведения  не  относится  к  сервису
автоматического    запуска,    а    вызвана    исключительно
особенностями  Oracle  Enterprise  Linux.  При использовании
сервисов автоматического запуска на других реализациях Lunix
обычно проблема не проявляется.

5.  При  зонной установке сервисов iAS на Solaris 10 и выше,
необходимо    скопировать   запускные   скрипты   init.ias_*
в каталог /lib/svc/method глобальной зоны с правами root:sys
_ПЕРЕД ЗАПУСКОМ_ сервисов. 

В    неглобальных    зонах    данный   каталог   монтируется
из  глобальной  зоны  с  правами  read  only  и  необходимые
действия по установке запускных методов в него не могут быть
корректно выполнены.
    
============================================================
Oracle iAS Autostart                  (C) 2006-2010 Y.Voinov
============================================================